// TODO: fix animation bug, duh.

var g6exp = {

    expSpeed:		8,
    expBaseIDName:	'expID',
    expNextID:		0,
    expTilesName:	'expTiles',
    expTileWidth:	16,
    expTileHeight:	16,
    expSpriteName:	'expSprite',
    expImageFileName:	'exAll.png',
    expMaxFrameIndex:	4, // !? can we calc this via akihabara? suck.
    expFramePause:	2,

    addExpFn: function( cx, cy, frameOffset ) {
	var sid = g6exp.nextID++;

	var exp = gbox.addObject( {
	    id: g6exp.baseIDName + sid,
	    group: g6.explosionGroupName,
	    tileset: g6exp.tilesName,
	    initialize: g6exp.initFn,
	    first: g6exp.firstFn,
	    blit: g6.standardBlitFn,
	    frameOffset: frameOffset,
	    colh: gbox.getTiles( g6exp.tilesName ).tileh,
	} );

	exp.x = cx - gbox.getTiles( exp.tileset ).tilehh;
	exp.y = cy - gbox.getTiles( exp.tileset ).tilehw;
    },
    
    expInitFn: function() {
	toys.topview.initialize( this, {} );
    },

    expFirstFn: function() {
	if( this.frame >= g6exp.maxFrameIndex ) {
	    g6.removeGboxObjFn( this );
	}
	else {
	    g6anim.updateFrameFn( this, g6exp.framePause, g6exp.expMaxFrameIndex );
	}
    },

    expLoadTilesFn: function() {
	gbox.addImage( g6exp.spriteName, g6exp.expImageFileName );
	gbox.addTiles( {
	    id: g6exp.tilesName,
	    image: g6exp.spriteName,
	    tilew: g6exp.tileWidth,
	    tileh: g6exp.tileHeight,
	    tilerow: g6exp.maxFrameIndex + 1,
	    gapx: 0,
	    gapy: 0
	} );
    },
}
