var g6enemy = {

    enemySpeed:			2,
    enemyBaseIDName:		'enemyID',
    enemyNextID:		0,
    enemyTilesName:		'enemyTiles',
    enemyTileWidth:		16,
    enemyTileHeight:		16,
    enemySpriteName:		'enemySprite',
    enemyImageFileName:		'enemySprite.png',
    thinkCountInit:		6,

    addEnemyFn: function() {
	var eid = g6enemy.nextID++;
	gbox.addObject( {
	    id: g6enemy.baseIDName + eid,
	    group: g6.enemyGroupName,
	    tileset: g6enemy.tilesName,
	    initialize: g6enemy.initFn,
	    first: g6enemy.firstFn,
	    blit: g6.standardBlitFn,
	    colh: gbox.getTiles( g6enemy.tilesName ).tileh,
	    explode: g6enemy.explodeFn,
	    speed: g6enemy.speed,
	} );
    },

    enemyInitFn: function() {
	toys.topview.initialize( this, {} );
	this.x = 100;
	this.y = 100;
    },

    enemyFirstFn: function() {
	if( ! this.thinkCount || this.thinkCount === 0 ) {
	    this.thinkCount = g6.thinkCountInit;

	    var dx = g6.player.x - this.x;
	    var dy = g6.player.y - this.y;
	    if( dx > 0 ) {
		this.mx = this.speed;
	    }
	    else if( dx < 0 ) {
		this.mx = -this.speed;
	    }
	    if( dy > 0 ) {
		this.my = this.speed;
	    }
	    else if( dy < 0 ) {
		this.my = -this.speed;
	    }
	}
	this.thinkCount--;
	this.x += this.mx;
	this.y += this.my;

	toys.topview.tileCollision( this, g6map.map, 'map', null, { tolerance: 6, approximation: 3 } );
    },

    enemyLoadTilesFn: function() {
	gbox.addImage( g6enemy.spriteName, g6enemy.enemyImageFileName );
	gbox.addTiles( {
	    id: g6enemy.tilesName,
	    image: g6enemy.spriteName,
	    tilew: g6enemy.tileWidth,
	    tileh: g6enemy.tileHeight,
	    tilerow: 1,
	    gapx: 0,
	    gapy: 0
	} );
    },

    enemyExplodeFn: function() {

	// !?: increment some score.
	// !?: check game over somewhere.

	var ox = gbox.getTiles( this.tileset ).tilehh;
	var oy = gbox.getTiles( this.tileset ).tilehw;

	var cx = this.x + ox;
	var cy = this.y + oy;

	g6exp.addExpFn( cx, cy );

	var dx = Math.floor( g6util.randomCentered( ox*3 ) );
	var dy = Math.floor( g6util.randomCentered( oy*3 ) );
	g6exp.addExpFn( cx + dx, cy + dy, -2 );
	
	var dx2 = Math.floor( g6util.randomCentered( ox*3 ) );
	var dy2 = Math.floor( g6util.randomCentered( oy*3 ) );
	g6exp.addExpFn( cx + dx2, cy + dy2, -4 );

	g6.removeGboxObjFn( this );

	// !?: just for testing fun: respawn!
	g6enemy.addEnemyFn();
    },
}
